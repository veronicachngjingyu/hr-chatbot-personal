<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR AI Chatbot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom scrollbar for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #e5e7eb; /* Lighter track */
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #9ca3af; /* Gray thumb */
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Darker gray on hover */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="relative w-full max-w-lg bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col h-[80vh] md:h-[70vh] lg:h-[60vh]">
        <!-- Chat Header -->
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-4 text-center text-2xl font-semibold rounded-t-xl shadow-md">
            HR Assistant Chatbot
        </div>

        <!-- Chat Messages Display Area -->
        <div id="chat-messages" class="flex-1 p-6 overflow-y-auto space-y-4 bg-gray-50">
            <!-- Initial Bot Message -->
            <div class="flex justify-start">
                <div class="bg-blue-100 text-blue-800 p-3 rounded-lg max-w-[80%] shadow-sm">
                    Hello! I'm your HR Assistant. How can I help you today? Remember to replace "YOUR_GEMINI_API_KEY_HERE" in the code with your actual API key for the chatbot to work on your website.
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden absolute inset-x-0 bottom-20 flex justify-center p-2">
            <div class="flex items-center space-x-2 bg-gray-200 text-gray-700 px-4 py-2 rounded-full shadow-lg">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-700"></div>
                <span>Typing...</span>
            </div>
        </div>

        <!-- Chat Input Area -->
        <div class="p-4 bg-white border-t border-gray-200 flex items-center rounded-b-xl shadow-inner">
            <input
                type="text"
                id="user-input"
                class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 mr-3"
                placeholder="Type your message here..."
                autocomplete="off"
            >
            <button
                id="send-button"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            >
                Send
            </button>
        </div>
    </div>

    <script type="module">
        // Get references to DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const loadingIndicator = document.getElementById('loading-indicator');

        // Initialize chat history for the AI model
        let chatHistory = [];

        // --- HR Policies Knowledge Base ---
        // This is a simple, hardcoded knowledge base for demonstration.
        // In a real application, this data would come from a database or external HR system.
        const hrPolicies = {
            "leave policy": {
                keywords: ["leave", "vacation", "sick leave", "annual leave", "time off"],
                content: `
                    **Annual Leave Policy:** Employees are entitled to 20 days of annual leave per calendar year, accrued monthly.
                    **Sick Leave Policy:** Employees are entitled to 10 days of paid sick leave per calendar year. A medical certificate is required for absences exceeding 3 consecutive days.
                    **Bereavement Leave:** Up to 5 days of paid leave for immediate family members.
                    **Requesting Leave:** All leave requests must be submitted through the HR portal at least 2 weeks in advance for annual leave.
                `
            },
            "expense claims": {
                keywords: ["expense", "reimbursement", "claim", "travel expenses"],
                content: `
                    **Expense Claim Policy:** Employees can claim reimbursement for business-related expenses.
                    **Procedure:** All claims must be submitted within 30 days of the expense incurrence via the company's expense management system. Original receipts are mandatory.
                    **Approval:** Claims require approval from your direct manager.
                    **Categories:** Common categories include travel, meals (within policy limits), and office supplies.
                `
            },
            "code of conduct": {
                keywords: ["code of conduct", "ethics", "behavior", "rules"],
                content: `
                    **Code of Conduct Policy:** Our company is committed to maintaining a respectful, safe, and ethical work environment.
                    **Key Principles:** This includes treating colleagues with respect, maintaining confidentiality, avoiding conflicts of interest, and adhering to all company policies and laws.
                    **Reporting Violations:** Any suspected violations should be reported to HR or a manager immediately.
                `
            },
            "birthday leave": {
                keywords: ["birthday leave", "birthday off", "birthday holiday"],
                content: `
                    **Birthday Leave Policy:** Employees are entitled to 1 day of paid leave for their birthday each calendar year.
                    **Usage:** This leave must be taken within the month of your birthday. Please coordinate with your manager.
                `
            },
            "parent care leave": {
                keywords: ["parent care leave", "elderly care leave", "caring for parents"],
                content: `
                    **Parent Care Leave Policy:** Employees are entitled to 3 days of paid leave per calendar year to care for their parents or elderly dependents.
                    **Purpose:** This leave is for situations requiring direct care, such as medical appointments or emergencies.
                `
            },
            "maternity leave": {
                keywords: ["maternity leave", "new mother leave", "pregnancy leave"],
                content: `
                    **Maternity Leave Policy:** Expectant mothers are entitled to 16 weeks of paid maternity leave.
                    **Eligibility:** Specific eligibility criteria apply, including length of service. Please consult HR for full details.
                `
            },
            "shared parental leave": {
                keywords: ["shared parental leave", "paternity leave", "new parent leave", "shared leave"],
                content: `
                    **Shared Parental Leave Policy:** Eligible parents can share up to 6 weeks of their parental leave entitlement.
                    **Flexibility:** This allows parents to share care for their child in the first year after birth or adoption.
                    **Application:** Joint application with your partner is required. Please contact HR for detailed guidance.
                `
            }
        };

        /**
         * Displays a message in the chat interface.
         * @param {string} message - The message content.
         * @param {string} sender - 'user' or 'bot'.
         */
        function displayMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', sender === 'user' ? 'justify-end' : 'justify-start');

            const messageBubble = document.createElement('div');
            messageBubble.classList.add(
                'p-3',
                'rounded-lg',
                'max-w-[80%]',
                'shadow-sm',
                sender === 'user' ? 'bg-indigo-600 text-white' : 'bg-blue-100 text-blue-800'
            );
            messageBubble.innerHTML = message; // Use innerHTML to render bold text from policies
            messageDiv.appendChild(messageBubble);
            chatMessages.appendChild(messageDiv);

            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        /**
         * Shows or hides the loading indicator.
         * @param {boolean} show - True to show, false to hide.
         */
        function toggleLoading(show) {
            if (show) {
                loadingIndicator.classList.remove('hidden');
                userInput.disabled = true;
                sendButton.disabled = true;
            } else {
                loadingIndicator.classList.add('hidden');
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus(); // Focus input after response
            }
        }

        /**
         * Sends the user's message and gets a response from the AI.
         */
        async function sendMessage() {
            const prompt = userInput.value.trim();
            if (prompt === '') return; // Don't send empty messages

            displayMessage(prompt, 'user'); // Display user's message
            userInput.value = ''; // Clear input field

            toggleLoading(true); // Show loading indicator

            let aiPrompt = prompt; // Default prompt
            let foundPolicy = null;

            // Check if the user's prompt contains keywords related to any HR policy
            const lowerCasePrompt = prompt.toLowerCase();
            for (const policyName in hrPolicies) {
                const policy = hrPolicies[policyName];
                for (const keyword of policy.keywords) {
                    if (lowerCasePrompt.includes(keyword)) {
                        foundPolicy = policy;
                        // If a policy is found, construct a specific prompt for the AI
                        aiPrompt = `Based *only* on the following HR policy information, answer the user's question. If the information does not contain the answer, state that you cannot find the answer in the provided policy.

                        HR Policy:
                        ${policy.content}

                        User's Question: "${prompt}"`;
                        break; // Found a matching policy, stop checking keywords
                    }
                }
                if (foundPolicy) break; // Stop checking policies
            }

            // Add user's prompt (or the enhanced AI prompt) to chat history
            chatHistory.push({ role: "user", parts: [{ text: aiPrompt }] });

            try {
                // --- IMPORTANT: For hosting on GitHub Pages, you MUST replace this with your actual Gemini API Key ---
                // Get your API key from Google AI Studio: https://aistudio.google.com/app/apikey
                // For production, use a backend proxy to keep your API key secure.
                const apiKey = "YOUR_GEMINI_API_KEY_HERE"; // Replace with your actual API Key

                if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                    console.error("API Key is missing or not replaced. Please get your API key from Google AI Studio and replace 'YOUR_GEMINI_API_KEY_HERE' in the code.");
                    displayMessage('Error: Gemini API Key is missing. Please check the console for instructions.', 'bot');
                    chatHistory.push({ role: "model", parts: [{ text: 'Error: Gemini API Key is missing. Please check the console for instructions.' }] });
                    toggleLoading(false);
                    return;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const payload = { contents: chatHistory };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    // Provide a more specific message if it's an API key related error (e.g., 403 Forbidden)
                    if (response.status === 403 || response.status === 401) {
                        displayMessage('Authentication Error: Please check your Gemini API Key. It might be invalid or missing permissions.', 'bot');
                        chatHistory.push({ role: "model", parts: [{ text: 'Authentication Error: Please check your Gemini API Key. It might be invalid or missing permissions.' }] });
                    } else {
                        displayMessage('Oops! Something went wrong with the AI service. Please try again later.', 'bot');
                        chatHistory.push({ role: "model", parts: [{ text: 'Oops! Something went wrong with the AI service. Please try again later.' }] }]);
                    }
                    return;
                }

                const result = await response.json();

                let botResponseText = 'I am sorry, I could not generate a response at this time.';

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    botResponseText = result.candidates[0].content.parts[0].text;
                } else {
                    console.warn('Unexpected API response structure:', result);
                    botResponseText = 'I received an unexpected response from the AI. Please try rephrasing your question.';
                }

                displayMessage(botResponseText, 'bot'); // Display bot's response
                chatHistory.push({ role: "model", parts: [{ text: botResponseText }] }); // Add to chat history

            } catch (error) {
                console.error('Error fetching AI response:', error);
                displayMessage('An error occurred while connecting to the AI. Please check your network connection.', 'bot');
                chatHistory.push({ role: "model", parts: [{ text: 'An error occurred while connecting to the AI. Please check your network connection.' }] });
            } finally {
                toggleLoading(false); // Hide loading indicator
            }
        }

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus on the input field when the page loads
        window.onload = () => {
            userInput.focus();
        };
    </script>
</body>
</html>
